<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>DV project</title>
  <meta content="" name="description">
  <meta content="" name="keywords">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">


</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="index.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span class="d-none d-lg-block">Life Expectancy</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div>
    <!-- End Logo -->

  </header>
  <!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link " href="index.html">
          <span>Introduction</span>
        </a>
      </li>
      <!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link " href="section1.html">
          <span>Section 1</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link " href="section2.html">
          <span>Section 2</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link " href="section3.html">
          <span>Section 3</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="section4.html">
          <span>Section 4</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link " href="conclusion.html">
          <span>Conclusion</span>
        </a>
      </li>

    </ul>

  </aside>
  <!-- End Sidebar-->

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Section 4 </h1>
  
    </div><!-- End Page Title -->

      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-8">
          <div class="row">

            <!-- Chart One -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Chart 1</h5>

                      <!-- Create a container to host the charts -->

                      <!-- first chart -->
                      <div id="container"></div>
                      <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.6.0/d3.js"></script>
                      <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
                    
                      <style>
                    
                        *{
                          font-family: Lato;
                        }
                    
                        .axis-x path {
                          stroke: #000;
                        }
                    
                        .line {
                          fill: none;
                          stroke-width: 1.5px;
                          stroke-linejoin: "round";
                          stroke-linecap: "round";
                        }
                    
                        .line:hover {
                          stroke-width: 2px;
                        }
                    
                        #headline{
                          min-width:100%;
                        }
                    
                        #menu{
                          display: inline;
                          width: 100%;
                          /* border:1px solid black; */
                          /* padding: 1%; */
                        }
                    
                        #nation{
                          display: inline;
                          padding-left: 1%;
                        }
                
                    
                    
                    
                      </style>
	


	<div id="menu"></div>

	<div class="graph">
		<svg width="500" height="300"></svg>
	</div>

	</div>


	<script>
    var lineColors = ['#cacaca','#423189', '#e88467']; // Add more colors as needed


		//define chart margins
		let svg = d3.select("svg"),
			margin = {
				top: 30,
				right: 80,
				bottom: 40,
				left: 50
			},
      
			width = svg.attr("width") - margin.left - margin.right,
			height = svg.attr("height") - margin.top - margin.bottom,
			g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

		//define time format
		var parseTime = d3.timeParse("%Y");


		//define scales
		let x = d3.scaleTime().range([0, width]),
			y = d3.scaleLinear().range([height, 0]),
			//color scale
			z = d3.scaleOrdinal(d3.schemeCategory20);

		//define line generator
		let line = d3.line()
			.curve(d3.curveBasis)
			.x(function(d) {
				return x(d.Year);
			})
			.y(function(d) {
					return y(d.expenditure);
			});

		//load data
		data = d3.csv("https://raw.githubusercontent.com/guidovalla/DV_project/main/data/4_1.csv", type, function(error, data) {
			if (error) throw error;



			// format the data
			// data.forEach( function(d) {
			//   console.log(d.Year);
			// d.Year = parseTime(d.Year);
			// console.log(d.Year)
			// });

			//parse data
			var countries = data.columns.slice(1).map(function(id) {
				return {
					id: id,
					values: data.map(function(d) {
						return {
							Year: d.Year,
							expenditure: d[id]

						};


					})
				};
			});

			console.log(countries);

			//

			//define x axis
			x.domain(d3.extent(data, function(d) {
				return d.Year;
			}));
			

			console.log("x domain", x.domain());



			//define y axis
			y.domain([
				d3.min(countries, function(c) {
					return d3.min(c.values, function(d) {
						return d.expenditure;
					});
				}),
				d3.max(countries, function(c) {
					return d3.max(c.values, function(d) {
						return d.expenditure;
					});
				})
			]);

			console.log("y domain", y.domain());

			//define color scale
// z.domain(countries.map(function(c, i) {
//     return {
//         id: c.id,
//         color: lineColors[i % lineColors.length] // Assign color from the array
//     };
// }));


			console.log("z domain", z.domain());

			//append x axis
			g.append("g")
				.attr("class", "axis axis-x")
				.attr("transform", "translate(0," + height + ")")
				.call(d3.axisBottom(x))
				.append("text")
				// .attr("transform", "rotate(-90)")
				.attr("y", 20)
				.attr("x", 310)
				.attr("dy", "0.9em")
				.attr("fill", "#000")
				.text("Year")
				.append("text")
				// .attr("transform", "rotate(-90)")
				.attr("y", 20)
				.attr("x", 310)
				.attr("dy", "0.9em")
				.attr("fill", "#000")
				.text("Source:Sipri");

			//append y axis
			g.append("g")
				.attr("class", "axis axis-y")
				.call(d3.axisLeft(y))
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", -50)
				.attr("x", -125)
				.attr("dy", "0.9em")
				.attr("fill", "#000")
				.text("Milions of people");

			//append country data to svg
			let country = g.selectAll(".country")
				.data(countries)
				.enter()
				.append("g")
				.attr("class", "country")
			// 	d3.selectAll(".myCheckbox").on("change",update);
      // update();

			// append country path to svg
			country.append("path")
				.attr("class", "line")
				.attr('id', function(d){ return 'line-' + d.id })
			  .attr("d", function(d) {return line(d.values); })
        .style("stroke", function(d, i) { return lineColors[i % lineColors.length]; }) // Assign color directly
        .style("stroke-width", 3) // Set the desired stroke width
        .style("stroke-dasharray", function(d, i) {
        // Set the dash array for the line you want to be dotted
        return i === 0 ? "5,5" : "none";
         })
        //.style("stroke", function(d) { return z(d.id).color; })
				.attr("opacity", 1);


        // Create a legend
var legend = g.append("g")
    .attr("class", "legend")
    .attr("transform", "translate(" + (width + 10) + "," + 0 + ")"); // Adjust the translate values as needed

// Append rectangles and text for each line in the legend
legend.selectAll("rect")
    .data(countries)
    .enter()
    .append("rect")
    .attr("x", 0)
    .attr("y", function(d, i) { return i * 20; }) // Adjust the spacing between legend items
    .attr("width", 18)
    .attr("height", 18)
    .style("fill", function(d, i) { return lineColors[i % lineColors.length]; }) 

legend.selectAll("text")
    .data(countries)
    .enter()
    .append("text")
    .attr("x", 25)
    .attr("y", function(d, i) { return i * 20 + 9; }) // Adjust the spacing and alignment
    .attr("dy", "0.35em")
    .style("font", "11px sans-serif")
    .text(function(d) { return d.id; });




			var longY = function (d) {return d.value.Year.length};
			console.log(longY);
			var longE = function (d) {return d.value.Year.length};
			console.log(longE);
			// append country labels to svg
			country.append("text")
				.datum(function(d) { return {id: d.id, value: d.values[d.values.length - 1]}; })
				.attr("transform", function(d) { return "translate(" + x(d.value.Year) + "," + y(d.value.countries) + ")"; })
				.attr("x", 3)
				.attr('id', function(d){ return 'text-' + d.id })
				.attr("dy", "0.35em")
				.style("font", "11px sans-serif")
				.attr("opacity", 1)
				//.text(function(d) { return d.id; });

			for (let i = 0; i < countries.length; i++) {
				var tick = document.createElement('input');
				tick.type = 'checkbox';
				tick.id = 'myCheckbox'+i;
				tick.name = countries[i].id;
				tick.value = countries[i].id;

        tick.checked = true;

				var label = document.createElement('label');
				label.for = countries[i].id
				label.appendChild(document.createTextNode(countries[i].id));
				var divcheck = document.createElement('div');
				divcheck.id="nation";
				// tick.appendChild(document.createTextNode(countries[i].id));
				divcheck.appendChild(tick);
				divcheck.appendChild(label);
				document.getElementById("menu").appendChild(divcheck);
        console.log("tick", tick)

       

				tick.addEventListener("click", function() {

					var lineSelected = this.value;
					var svgline = d3.select('#line-' + lineSelected);
					var textline = d3.select('#text-' + lineSelected);
					console.log(svgline);
					console.log(textline);

					if(svgline.attr('opacity') === '1') {
						// console.log('making it visible');
						svgline.attr('opacity', 0);
					} else {
						svgline.attr('opacity', 1);
					}

					if(textline.attr('opacity') === '1') {
						// console.log('making it visible');
						textline.attr('opacity', 0);
					} else {
						textline.attr('opacity', 1);
					}
					this.style.background = '#555';
					this.style.color = 'white';
          
				});
        

        
			}



		});

		//bind with multiseries data
		function type(d, _, columns) {
			d.Year = parseTime(d.Year);
			//iterate through each column
			for (var i = 1, n = columns.length, c; i < n; ++i) d[c = columns[i]] = +d[c];

			//bind column data to year
			return d;
		}




    

	</script>
                </div>

              </div>
            </div>

            <!-- Second chart -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title">Chart 2</h5>

<!-- Include d3 library -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-geo@"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-geo-projection@4"></script>
<script src="https://unpkg.com/topojson@3"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
<!-- Create a container to host the chart -->
<div id="viz_container_2"></div>
<div id="slider-range_2"></div>

                            <!-- Load slider -->
                            <script src="https://unpkg.com/d3-simple-slider"></script>

<style>
    svg {
  width: 300;
  height: 300;
}
text {
  font-family: lato;
  font-size: 10px;
  fill: #333333;
}
.grid path {
  stroke-width: 0;
  stroke: #333333;
}
.grid .tick line {
  stroke: #333333;
  stroke-width: 0.3px;
  stroke-opacity: 0.3;
}
text.chart-label {
  font-size: 10px;
  font-weight: 400;
  fill: #999999;
}

text.chart-title {
  font-size: 14px;
  font-weight: bold;
  fill:#222222
}
text.chart-source {
  font-size: 8px;
  fill: #999999;
}
text.copyright {
  font-size: 8px;
  fill: #999999;
}

.tooltip {
  background-color: #ffffff;
  font-family: lato;
  font-size: 11px;
  padding: 4px;
  color: #666666;
  border: none;
  box-shadow: 0px 0px 3px 0px #E6E6E6;
}
.legend{
  font-size: 10px;
}
</style>

<script>
const margin2 = {top: 30, right: 20, bottom: 30, left: 20};
const width2 = 450 - margin2.left - margin2.right;
const height2 = 350 - margin2.top - margin2.bottom;

// append the svg object to the body of the page
const svg2 = d3.select("#viz_container_2")
  .append("svg")
    .attr("width", "600")
    .attr("height", "400")
    .attr("viewBox", "0 0 450 350")
    .attr("preserveAspectRatio", "xMinYMin")
  .append("g")
    .attr("transform", `translate(${margin2.left}, ${margin2.top})`);
    
    var Year=2025

    

// parse the Data
//d3.csv("https://raw.githubusercontent.com/GDS-ODSSS/unhcr-dataviz-platform/master/data/part_to_a_whole/treemap_d3.csv")
d3.csv("https://raw.githubusercontent.com/guidovalla/DV_project/main/data/4_2.csv")
.then(function(data){

  console.log("data", data)


  fdata  = data.filter(function (d) {
                      return d.Time == Year;
                    });
  
  

fdata.forEach(function(d) {
    d.Pop = +d.Pop;
    d.enabled = true;
  });
  fdata.push({Location: "root", LE: "", Pop: "", parent: "",})
  console.log("fdata", fdata)

const total = d3.sum(fdata.map(function(d) {
  return (d.enabled) ? d.Pop : 0;  }));

// reshape data
const treeData = d3.stratify()
  .id(d => d.Location)
  .parentId(d => d.parent)
  (fdata);

treeData.sum(d => d.Pop)

treeData.sort(function(a, b) { return b.height - a.height || b.value - a.value; });
                  

d3.treemap()
  .size([width, height])
  .padding(2)
  (treeData);

// create a tooltip
const tooltip = d3.select("body")
  .append("div")
    .attr("class", "tooltip");

// tooltip events
const mouseover = function(d) {
  tooltip
      .style("opacity", 1)
  d3.select(this)
      .style("opacity", .5)
};
const mousemove = function(event,d) {
  f = d3.format(",")
  tooltip
  .html("Number of staff: " + `${f(d.data.Pop)}`)
    .style("top", event.pageY - 10 + "px")
    .style("left", event.pageX + 10 + "px")
};
const mouseleave = function(d) {
  tooltip
    .style("opacity", 0)
  d3.select(this)
    .style("stroke", "none")
    .style("opacity", 1)
};
// const colorScale = d3.scaleSequential(d3.interpolateBlues)
//   .domain([0, d3.max(treeData.leaves(), d => d.data.LE)]);
// const colorScale = d3.scaleSequential(d3.interpolateBlues)
//   .domain([1, d3.max(treeData.leaves(), d => d.data.LE)])
//   .interpolator(d3.interpolateTurbo); // Use a different color interpolation for better visibility
// Define your custom array of colors
const myColors = ["#89CFF0", "#0096FF", "#005eab", "#00008B", "#060c36"];

// Create a d3.scaleSequential based on the custom colors
const colorScale = d3.scaleSequential()
  .domain([60, d3.max(treeData.leaves(), d => d.data.LE)])
  .interpolator(d3.scaleSequential(d3.interpolateRgbBasis(myColors)));
// create rectangle
svg2
  .selectAll("rect")
  .data(treeData.leaves())
  .join("rect")
    .attr('x', d => d.x0)
    .attr('y', d => d.y0)
    .attr('width', d => d.x1 - d.x0)
    .attr('height', d=> d.y1 - d.y0)
    .style("stroke", "none")
    .style("fill", d => colorScale(d.data.LE))
    //.style("fill", d => colorScale(Math.max(1, d.data.LE))) // Use Math.max to handle values <= 0
  .on("mouseover", mouseover)
  .on("mousemove", mousemove)
  .on("mouseleave", mouseleave);

// add labels to the graph
svg2
  .selectAll("text-number")
  .data(treeData.leaves())
  .join("text")
    .attr("class", "tree-label")
    .attr("x", d => d.x0+5)
    .attr("y", d => d.y0+15)
    //.text(d => Math.round(1000 * d.data.population / total) / 10 + "%")
    .text(d => "Life expectancy: " + (d.data.LE/1).toFixed(0) )
    .attr("font-size", "10px")
    .attr("fill", "#ffffff");
svg2
  .selectAll("text-region")
  .data(treeData.leaves())
  .join("text")
    .attr("class", "tree-label")
    .attr("x", d => d.x0+5)
    .attr("y", d => d.y0+30)
    .text(d => d.data.Location)
    .attr("font-size", "10px")
    .attr("fill", "#ffffff");

// set title
svg2
  .append("text")
    .attr("class", "chart-title")
    .attr("x", 0)
    .attr("y", -(margin.top)/1.5)
    .attr("text-anchor", "start")
  .text("UNHCR global workforce by region | 2021");

// set source
svg2
  .append("text")
    .attr("class", "chart-source")
    .attr("x", 0)
    .attr("y", height + margin.bottom*0.4)
    .attr("text-anchor", "start")
  .text("Source: UNHCR")

// set copyright
svg2
  .append("text")
    .attr("class", "copyright")
    .attr("x", 0)
    .attr("y", height + margin.bottom*0.7)
    .attr("text-anchor", "start")
  .text("Â©UNHCR, The UN Refugee Agency")
  const sliderRange= d3
.sliderBottom()
.min(2023)
.max(2100)
.width(300)
.step(1)
.tickFormat(d3.format('Y'))
.ticks(5)
.default(2025)
.on('onchange', val => {
    year = val
      updateChart(year)
    })

  const gRange= d3.
                          select('#slider-range_2')
                          .append("svg")
                          .attr("width", 700 + margin2.left + margin2.right)
                          .attr("height", 200 + margin2.top + margin2.bottom)
                          .append("g")
                          .attr("transform","translate(" + margin2.left + "," + margin2.top + ")")
                          .call(sliderRange);


                          function updateChart(Year){
                  d3.selectAll("rect").remove()
                  d3.selectAll("text").remove()
                  //filter the data
                  fdata  = data.filter(function (d) {
                      return d.Time == Year;
                    });
                    fdata  = data.filter(function (d) {
                      return d.Time == Year;
                    });
  
  

                      fdata.forEach(function(d) {
                          d.Pop = +d.Pop;
                          d.enabled = true;
                        });
                        fdata.push({Location: "root", LE: "", Pop: "", parent: "",})
                        console.log("fdata", fdata)

                      const total = d3.sum(fdata.map(function(d) {
                        return (d.enabled) ? d.Pop : 0;  }));
                  // reshape fdata
                  const treeData = d3.stratify()
                    .id(d => d.Location)
                    .parentId(d => d.parent)
                    (fdata);
                  
                  treeData.sum(d => d.Pop)
                  
                  //sort treedata on value
                  treeData.sort(function(a, b) { return b.height - a.height || b.value - a.value; });
                  
                  d3.treemap()
                    .size([width, height])
                    .padding(2)
                    (treeData);
                    const myColors = ["#89CFF0", "#0096FF", "#005eab", "#00008B", "#060c36"];

                    // Create a d3.scaleSequential based on the custom colors
                    const colorScale = d3.scaleSequential()
                      .domain([60, d3.max(treeData.leaves(), d => d.data.LE)])
                      .interpolator(d3.scaleSequential(d3.interpolateRgbBasis(myColors)));
                    // create rectangle
                  
                  svg2
                    .selectAll("rect")
                    .data(treeData.leaves())
                    .join("rect")
                      .attr('x', d => d.x0)
                      .attr('y', d => d.y0)
                      .attr('width', d => d.x1 - d.x0)
                      .attr('height', d=> d.y1 - d.y0)
                      .style("stroke", "none")
                      .style("fill", d => colorScale(d.data.LE))
                      //.style("fill", "#0072BC")
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave);
                  
                    svg2
                    .selectAll("text-number")
                    .data(treeData.leaves())
                    .join("text")
                      .attr("class", "tree-label")
                      .attr("x", d => d.x0+5)
                      .attr("y", d => d.y0+15)
                      //.text(d => Math.round(1000 * d.data.val / total) / 10 + "%")
                      .text(d => "Life expectancy: " + (d.data.LE/1).toFixed(0) )
                      .attr("font-size", "5px")
                      .attr("fill", "#ffffff");
                  svg2
                    .selectAll("text-region")
                    .data(treeData.leaves())
                    .join("text")
                      .attr("class", "tree-label")
                      .attr("x", d => d.x0+5)
                      .attr("y", d => d.y0+30)
                      .text(d => d.data.Location)
                      .attr("font-size", "4px")
                      .attr("fill", "#ffffff");
                  }
})
</script>
                </div>

              </div>

            </div>
                      <!-- third chart -->
                      
                        <div class="col-12">
                        <div class="card">
                          <div class="card-body">
                            <h5 class="card-title">Chart 3</h5>
                             
                            <!-- Load slider -->
                            <script src="https://unpkg.com/d3-simple-slider"></script>
                      
                            <div id="container_3"></div>
                      <div id="slider-range_3"></div>

                      <script>
                          // set the dimensions and margins of the graph
const margin3 = {top: 60, right: 20, bottom: 20, left: 100};
  const width3 = 450 - margin3.left - margin3.right;
  const height3 = 350 - margin3.top - margin3.bottom;

  // append the svg object to the body of the page
  const svg3 = d3.select("#container_3")
    .append("svg")
      .attr("width", "100%")
      .attr("height", "100%")
      .attr("viewBox", "0 0 450 350")
      .attr("preserveAspectRatio", "xMinYMin")
    .append("g")
      .attr("transform", `translate(${margin3.left}, ${margin3.top})`);

  // parse the Data
  d3.csv("https://raw.githubusercontent.com/guidovalla/DV_project/main/data/4_3_new.csv")
  .then(function(data){

    var uniqueYearsSet = new Set(data.map(d => d.Year));
    var allYears = Array.from(uniqueYearsSet);
    console.log("years", allYears)


    


  // X scale and Axis
  const xScaleMale = d3.scaleLinear()
    .domain([0, 1.2*d3.max(data, d => +d.male)])
    .range([width3/2, 0]);
  svg3
    .append("g")
        .attr("transform", `translate(0, ${height2})`)
    .call(d3.axisBottom(xScaleMale).tickSize(0).tickPadding(3).ticks(7, ""))
    .call(function(d) { return d.select(".domain").remove()});

  const xScaleFemale = d3.scaleLinear()
    .domain([0, 1.2* d3.max(data, d => +d.female)])
    .range([width3/2, width3]);
  svg3
    .append("g")
        .attr("transform", `translate(0, ${height2})`)
    .call(d3.axisBottom(xScaleFemale).tickSize(0).tickPadding(3).ticks(7, ""))
    .call(function(d) { return d.select(".domain").remove()});

  // set vertical grid line
  const GridLineF = function() { return d3.axisBottom().scale(xScaleFemale)};
  svg3
    .append("g")
      .attr("class", "grid")
    .call(GridLineF()
      .tickSize(height2,0,0)
      .tickFormat("")
      .ticks(7)
  );
  const GridLineM = function() { return d3.axisBottom().scale(xScaleMale)};
  svg3
    .append("g")
      .attr("class", "grid")
    .call(GridLineM()
      .tickSize(height2,0,0)
      .tickFormat("")
      .ticks(7)
  );

  // Y scale and Axis
  const yScale = d3.scaleBand()
      .domain(data.map(d => d.ages))
      .range([height2, 0])
      .padding(.25);
  svg3
      .append("g")
      .call(d3.axisLeft(yScale).tickSize(0).tickPadding(15))
      .call(d => d.select(".domain").remove());

  // create a tooltip
  const tooltip = d3.select("body")
    .append("div")
      .attr("class", "tooltip");

  // tooltip events
  const mouseover = function(d) {
      tooltip
        .style("opacity", 1)
      d3.select(this)
        .style("stroke", "#EF4A60")
        .style("opacity", .5)
  };
  const mousemove1 = function(event,d) {

      tooltip
      .html( `${d3.format(".2f")(d.male)}  Billions`)
        .style("top", event.pageY - 10 + "px")
        .style("left", event.pageX + 10 + "px");
  };
  const mousemove2 = function(event,d) {
    tooltip
    .html(`${d3.format(".2f")(d.female)}  Billions`)
      .style("top", event.pageY - 10 + "px")
      .style("left", event.pageX + 10 + "px")
};
  const mouseleave = function(d) {
      tooltip
        .style("opacity", 0)
      d3.select(this)
        .style("stroke", "none")
        .style("opacity", 1)
  };

  var Pippo = "2023"

  var dataFilter = data.filter(function(d){return d.Year==Pippo})

  // create male bars
  svg3
    .selectAll(".maleBar")
      .data(dataFilter)
    .join("rect")
      .attr("class", "barMale")
      .attr("x", d => xScaleMale(d.male))
      .attr("y", d => yScale(d.ages))
      .attr("width", d => width3/2 - xScaleMale(d.male))
      .attr("height", yScale.bandwidth())
      .style("fill", "#18375F")
    .on("mouseover", mouseover)
    .on("mousemove", mousemove1)
    .on("mouseleave", mouseleave)

  // create female bars
  svg3
      .selectAll(".femaleBar")
        .data(dataFilter)
      .join("rect")
        .attr("class", "barFemale")
        .attr("x", xScaleFemale(0))
        .attr("y", d => yScale(d.ages))
        .attr("width", d => xScaleFemale(d.female) - xScaleFemale(0))
        .attr("height", yScale.bandwidth())
        .style("fill", "#0072BC")
      .on("mouseover", mouseover)
      .on("mousemove", mousemove2)
      .on("mouseleave", mouseleave)

  // set x axis label
  svg3
      .append("text")
          .attr("class", "chart-label")
          .attr("x", width3/3.5)
          .attr("y", height2 + margin3.bottom/1.5)
      .text("Population (billions)")

  //set legend
  svg3
      .append("rect")
          .attr("x", -(margin3.left)*0.7)
          .attr("y", -(margin3.top/3))
          .attr("width", 13)
          .attr("height", 13)
          .style("fill", "#18375F")
  svg3
      .append("text")
          .attr("class", "legend")
          .attr("x", -(margin3.left)*0.6+15)
          .attr("y", -(margin3.top/5.5))
      .text("Male")
  svg3
      .append("rect")
          .attr("x", 40)
          .attr("y", -(margin3.top/3))
          .attr("width", 13)
          .attr("height", 13)
          .style("fill", "#0072BC")
  svg3
      .append("text")
          .attr("class", "legend")
          .attr("x", 60)
          .attr("y", -(margin3.top/5.5))
      .text("Female")

         //add slider 
        
         const sliderRange= d3
.sliderBottom()
.min(2023)
.max(2100)
.width(200)
.step(1)
.tickFormat(d3.format('Y'))
.ticks(5)
.default(2023)
.on('onchange', val => {
    Pippo = val
      update(Pippo)
    })
        const gRange= d3.
        select('#slider-range_3')
        .append("svg")
        .attr("width", 100+ margin3.left + margin3.right)
        .attr("height", 50+ margin3.bottom)
        .append("g")
        .attr("transform","translate(" + margin3.right+ "," + margin3.bottom + ")")
        .call(sliderRange);




      function update(selectedYear) {
  // Remove existing bars
  svg3.selectAll(".barMale").remove();
  svg3.selectAll(".barFemale").remove();

  // Filter data for the selected year
  const dataFilter = data.filter(function (d) {
    return d.Year == selectedYear;
  });

  // Update male bars
  svg3
    .selectAll(".maleBar")
    .data(dataFilter)
    .enter()
    .append("rect")
    .attr("class", "barMale")
    .attr("x", (d) => xScaleMale(d.male))
    .attr("y", (d) => yScale(d.ages))
    .attr("width", (d) => width3 / 2 - xScaleMale(d.male))
    .attr("height", yScale.bandwidth())
    .style("fill", "#18375F")
    .on("mouseover", mouseover)
    .on("mousemove", mousemove1)
    .on("mouseleave", mouseleave);

  // Update female bars (similar code as above)
  svg3
    .selectAll(".femaleBar")
    .data(dataFilter)
    .enter()
    .append("rect")
    .attr("class", "barFemale")
    .attr("x", xScaleFemale(0))
    .attr("y", (d) => yScale(d.ages))
    .attr("width", (d) => xScaleFemale(d.female) - xScaleFemale(0))
    .attr("height", yScale.bandwidth())
    .style("fill", "#0072BC")
    .on("mouseover", mouseover)
    .on("mousemove", mousemove2)
    .on("mouseleave", mouseleave);
}


  
  d3.select("#YearsButton").on("change", function(d) {
    Pippo = d3.select(this).property("value")
    update(Pippo)
  })

  })
                      </script>
                          </div>

                        </div>
                </div>

              </div>

            </div>

          </div>

        </div>
        
        <!-- End Left side columns -->

    

      </div>
    </section>

  </main>
  <!-- End #main -->



  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>