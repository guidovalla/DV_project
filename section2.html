<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>DV Project</title>
  <meta content="" name="description">
  <meta content="" name="keywords">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">


</head>

<body>

  <!-- ======= Header ======= -->
  <header id="header" class="header fixed-top d-flex align-items-center">

    <div class="d-flex align-items-center justify-content-between">
      <a href="introduction.html" class="logo d-flex align-items-center">
        <img src="assets/img/logo.png" alt="">
        <span class="d-none d-lg-block">Life Expectancy</span>
      </a>
      <i class="bi bi-list toggle-sidebar-btn"></i>
    </div>
    <!-- End Logo -->

  </header>
  <!-- End Header -->

  <!-- ======= Sidebar ======= -->
  <aside id="sidebar" class="sidebar">

    <ul class="sidebar-nav" id="sidebar-nav">

      <li class="nav-item">
        <a class="nav-link " href="index.html">
          <span>Introduction</span>
        </a>
      </li>
      <!-- End Dashboard Nav -->

      <li class="nav-item">
        <a class="nav-link " href="section1.html">
          <span>Section 1</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link " href="section2.html">
          <span>Section 2</span>
        </a>
      </li>
      
      <li class="nav-item">
        <a class="nav-link " href="section3.html">
          <span>Section 3</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link " href="section4.html">
          <span>Section 4</span>
        </a>
      </li>

      <li class="nav-item">
        <a class="nav-link " href="conclusion.html">
          <span>Conclusion</span>
        </a>
      </li>

    </ul>

  </aside>
  <!-- End Sidebar-->

  <main id="main" class="main">

    <div class="pagetitle">
      <h1>Section 2</h1>
    </div><!-- End Page Title -->

      <div class="row">

        <!-- Left side columns -->
        <div class="col-lg-8">
          <div class="row">

            <!-- Chart One -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <object data="charts/2_1.html", class="box"></object>

                </div>

              </div>
            </div>

            <!-- Second chart -->
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <object data="charts/2_2.html", class="box"></object>
                </div>

              </div>

            </div>
                      <!-- third chart -->
                      <div class="col-12">
                        <div class="card">
                          <div class="card-body">
                            <object data="charts/2_3.html", class="box"></object>
                          </div>

                        </div>
                </div>
 <!-- fourth chart -->
                      <div class="col-12">
                        <div class="card">
                          <div class="card-body">
                            <object data="charts/2_4.html", class="box"></object>

                          </div>

                        </div>
                </div>
                 <!-- fifth chart -->
                 <div class="col-12">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title">Chart 4</h5>
                <div id="container_5"></div>
                <div id="slider-range_5"></div>
                <select id="CountryButton"></select>

                <script>

                  // set the dimensions and margins of the graph
                  const margin5 = {top: 30, right: 20, bottom: 30, left: 20};
                  const width5 = 450 - margin5.left - margin5.right;
                  const height5 = 350 - margin5.top - margin5.bottom;
                  
                  // append the svg object to the body of the page
                  const svg5 = d3.select("#container_5")
                    .append("svg")
                      .attr("width", "100%")
                      .attr("height", "100%")
                      .attr("viewBox", "0 0 450 350")
                      .attr("preserveAspectRatio", "xMinYMin")
                    .append("g")
                      .attr("transform", `translate(${margin.left}, ${margin.top})`);
                  
                      var Year=2019
                      var Country="Afghanistan"
                      
                  // parse the Data
                  //d3.csv("https://raw.githubusercontent.com/GDS-ODSSS/unhcr-dataviz-platform/master/data/part_to_a_whole/treemap_d3.csv")
                  d3.csv("https://raw.githubusercontent.com/guidovalla/DV_project/main/data/2_3.csv")
                  
                  .then(function(data){
                    fdata  = data.filter(function (d) {
                      return d.year == Year;
                    });
                  //list of unique locations
                  var map = new Map();
                  var countries = [];
                  for (const item of data) {
                      if(!map.has(item.location)){
                          map.set(item.location, true);    // set any value to Map
                          countries.push({
                              Country: item.location
                          });
                      }
                  }
                  countries=countries.map(d=>d.Country)
                  countries=countries.filter(d=>d!="")
                  countries=countries.sort()
                  
                  
                    // Initialize a Dropdown
                    d3.select("#CountryButton")
                                      .selectAll('myOptions')
                                      .data(countries)
                                      .enter()
                                      .append('option')
                                      .attr("value", d =>d) // corresponding value returned by the button
                                      .text(d=>d)
                                      
                                      fdata  = fdata.filter(function (d) {
                      return d.location == Country;
                    });
                  
                    //append a row to fdata
                    fdata.push({parent: "", cause: "root", val: ""})
                  
                  
                  
                  fdata.forEach(function(d) {
                      d.val = +d.val;
                      d.enabled = true;
                    });
                  
                  const total = d3.sum(fdata.map(function(d) {
                    return (d.enabled) ? d.val : 0;  }));
                  
                  // reshape fdata
                  const treeData = d3.stratify()
                    .id(d => d.cause)
                    .parentId(d => d.parent)
                    (fdata);
                  
                  
                  treeData.sum(d => d.val)
                  
                  //sort treedata on value
                  treeData.sort(function(a, b) { return b.height - a.height || b.value - a.value; });
                  
                  d3.treemap()
                    .size([width, height])
                    .padding(2)
                    (treeData);
                  
                  // create a tooltip
                  const tooltip = d3.select("body")
                    .append("div")
                      .attr("class", "tooltip");
                  
                  // tooltip events
                  const mouseover = function(d) {
                    tooltip
                        .style("opacity", 1)
                    d3.select(this)
                        .style("opacity", .5)
                  };
                  const mousemove = function(event,d) {
                    f = d3.format(",")
                    tooltip
                    
                    .html("Percentage: " + (d.data.val/10).toFixed(2)+ "%")
                  
                      .style("top", event.pageY - 10 + "px")
                      .style("left", event.pageX + 10 + "px")
                  };
                  const mouseleave = function(d) {
                    tooltip
                      .style("opacity", 0)
                    d3.select(this)
                      .style("stroke", "none")
                      .style("opacity", 1)
                  };
                  
                  // create rectangle
                  svg5
                    .selectAll("rect")
                    .data(treeData.leaves())
                    .join("rect")
                      .attr('x', d => d.x0)
                      .attr('y', d => d.y0)
                      .attr('width', d => d.x1 - d.x0)
                      .attr('height', d=> d.y1 - d.y0)
                      .style("stroke", "none")
                      .style("fill", "#0072BC")
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave);
                  
                  // add labels to the graph
                  svg5
                    .selectAll("text-number")
                    .data(treeData.leaves())
                    .join("text")
                      .attr("class", "tree-label")
                      .attr("x", d => d.x0+5)
                      .attr("y", d => d.y0+15)
                      //.text(d => Math.round(1000 * d.data.val / total) / 10 + "%")
                      .text(d => (d.data.val/10).toFixed(2)+ "%")
                      .attr("font-size", "5px")
                      .attr("fill", "#ffffff");
                  svg5
                    .selectAll("text-region")
                    .data(treeData.leaves())
                    .join("text").style("font-size", "4px")
                      .attr("class", "tree-label")
                      .attr("x", d => d.x0+5)
                      .attr("y", d => d.y0+30)
                      .text(d => d.data.cause)
                      .attr("font-size", "4px")
                      .attr("fill", "#ffffff");
                  
                  // set title
                  svg5
                    .append("text").style("font-size", "4px")
                      .attr("class", "chart-title")
                      .attr("x", 0)
                      .attr("y", -(margin.top)/1.5)
                      .attr("text-anchor", "start")
                    .text("Death Causes per country, in %");
                  
                  //add slider 
                          
                  const sliderRange= d3
                  .sliderBottom()
                  .min(1990)
                  .max(2019)
                  .width(300)
                  .step(1)
                  .tickFormat(d3.format('Y'))
                  .ticks(5)
                  .default(2019)
                  .on('onchange', val => {
                      Year = val
                        updateChart(Year, Country)
                      })
                  d3.select("#CountryButton").on("change", function () {
                                      Country = d3.select(this).property("value");
                                      updateChart(Year, Country);
                                  });
                          const gRange= d3.
                          select('#slider-range_5')
                          .append("svg")
                          .attr("width", 700 + margin.left + margin.right)
                          .attr("height", 200 + margin.top + margin.bottom)
                          .append("g")
                          .attr("transform","translate(" + margin.left + "," + margin.top + ")")
                          .call(sliderRange);
                  
                  function updateChart(Year, Country){
                  d3.selectAll("rect").remove()
                  d3.selectAll("text").remove()
                  //filter the data
                  fdata  = data.filter(function (d) {
                      return d.year == Year;
                    });
                  
                    fdata  = fdata.filter(function (d) {
                      return d.location == Country;
                    });
                  
                  //append a row to fdata
                  fdata.push({parent: "", cause: "root", val: ""})
                  
                  
                  
                  fdata.forEach(function(d) {
                      d.val = +d.val;
                      d.enabled = true;
                    });
                  
                  const total = d3.sum(fdata.map(function(d) {
                    return (d.enabled) ? d.val : 0;  }));
                  
                  // reshape fdata
                  const treeData = d3.stratify()
                    .id(d => d.cause)
                    .parentId(d => d.parent)
                    (fdata);
                  
                  treeData.sum(d => d.val)
                  
                  //sort treedata on value
                  treeData.sort(function(a, b) { return b.height - a.height || b.value - a.value; });
                  
                  d3.treemap()
                    .size([width, height])
                    .padding(2)
                    (treeData);
                  
                  
                  svg5
                    .selectAll("rect")
                    .data(treeData.leaves())
                    .join("rect")
                      .attr('x', d => d.x0)
                      .attr('y', d => d.y0)
                      .attr('width', d => d.x1 - d.x0)
                      .attr('height', d=> d.y1 - d.y0)
                      .style("stroke", "none")
                      .style("fill", "#0072BC")
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave);
                  
                    svg5
                    .selectAll("text-number")
                    .data(treeData.leaves())
                    .join("text")
                      .attr("class", "tree-label")
                      .attr("x", d => d.x0+5)
                      .attr("y", d => d.y0+15)
                      //.text(d => Math.round(1000 * d.data.val / total) / 10 + "%")
                      .text(d => (d.data.val/10).toFixed(2)+ "%")
                      .attr("font-size", "5px")
                      .attr("fill", "#ffffff");
                  svg5
                    .selectAll("text-region")
                    .data(treeData.leaves())
                    .join("text")
                      .attr("class", "tree-label")
                      .attr("x", d => d.x0+5)
                      .attr("y", d => d.y0+30)
                      .text(d => d.data.cause)
                      .attr("font-size", "4px")
                      .attr("fill", "#ffffff");
                  }
                    })
                  
                  </script>     
                
              </div>

            </div>
              </div>

            </div>

          </div>

        </div>
        
        <!-- End Left side columns -->

    

      </div>
    </section>

  </main>
  <!-- End #main -->



  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>
