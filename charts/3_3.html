<h5 class="card-title">Improvements for each cause of death</h5>
<p, style="font-size: 16px;">
  In this bar chart it is possible to see the amount of deaths during a year, separated by the cause of death. A slider is present at the bottom of the chart, by clicking and dragging the slider is possible to change the year visualized in the chart
<!-- Create a container to host the charts -->

<!-- Include d3 library -->
<script src="https://d3js.org/d3.v7.min.js"></script>

<!-- Load slider -->
<script src="https://unpkg.com/d3-simple-slider"></script>


<!-- first chart -->
<!-- Create a container to host the chart -->
<div id="container3"></div>

<style>
* {
      font-family: Verdana;
      font-size: 18px;
      line-height: 1.5;
      max-width: 700px; 
      margin: 0 auto; 
    }
    h5 {
padding-top: 20px;
    }
  text {
    font-family: lato;
    font-size: 10px;
    fill: #333333;
  }
  .grid path {
    stroke-width: 0;
  }
  .grid .tick line {
    stroke: #333333;
    stroke-width: 0.3px;
    stroke-opacity: 0.3;
  }
  text.chart-title {
    font-size: 14px;
    font-weight: bold;
    fill:#222222
  }
  text.chart-label {
    font-size: 10px;
    font-weight: 400;
    fill: #999999;
  }
  text.chart-source {
    font-size: 8px;
    fill: #999999;
  }
  text.copyright {
    font-size: 8px;
    fill: #999999;
  }
  .tooltip {
    background-color: #ffffff;
    font-family: lato;
    font-size: 11px;
    padding: 6px;
    color: #333333;
    border: none;
    box-shadow: 0px 0px 3px 0px #E6E6E6;
  }
  </style>
              <script>
// set the dimensions and margins of the graph
const margin3 = {top: 30, right: 110, bottom: 30, left: 60};
const width3 = 600 - margin3.left - margin3.right;
const height3 = 350 - margin3.top - margin3.bottom;


// Declare the chart dimensions and margins.
/*const margin = { top: 20, right: 60, bottom: 60, left: 60 }
const width = 700 - margin.left - margin.right;
const height = 300 - margin.top - margin.bottom;
*/
// Create the SVG container.
const svg3 = d3.select("#container3")
.append("svg")
.attr("width", "100%")
  .attr("height", "60%")
  .attr("viewBox", "0 0 500 430")
.append("g")
.attr("transform", "translate(" + margin3.left + "," + margin3.top + ")");

    // Load CSV data
    d3.csv("https://raw.githubusercontent.com/guidovalla/DV_project/main/data/3_3.csv")
        .then((data) => {
            // Extract unique years and age categories
            const years = [...new Set(data.map(d => d.Period))];
            // Declare the x (horizontal position) scale.
            const x = d3.scaleBand()
                .domain(data.map(e => e.Dim3))
                .range([0, width3])
                .padding(0.2);
            // Declare the y (vertical position) scale.
            const y = d3.scaleLinear()
                .domain([0, Math.max(...data.map(e => e.Value)) + 50])
                .range([height3, 0]);


                // X-axis
                svg3.append("g")
                    .attr("transform", "translate(0," + height3 + ")")
                    .call(d3.axisBottom(x))
                    .selectAll("text")
                    .attr("transform", "translate(-10,0)rotate(-45)")
                    .style("text-anchor", "end");

                // Y-axis
                svg3.append("g")
                    .call(d3.axisLeft(y));
                
  svg3
.append("text")
.attr("class", "chart-label")
.attr("x", -(margin3.left)*0.7)
.attr("y", -(margin3.top/9))
.attr("text-anchor", "start")
.text("Deaths")

            // Initial bars
            updateBars(2000);

            // Update bars when year changes
            function updateBars(selectedYear) {
                svg3.selectAll(".bar").remove(); // Remove previous bars
                const dataFilter = data.filter(d => {
                    if (d.Period == selectedYear) {
                        return {
                            Dim3: d.Dim3,
                            Value: d.Value
                        }
                    }
                });

                // Bars
                svg3.selectAll(".bar")
                    .data(dataFilter)  // Start from the third entry to avoid "Period" and "Dim3"
                    .enter()
                    .append("rect")
                    .attr("class", "bar")
                    .attr("x", (e) => x(e.Dim3))
                    .attr("y", (e) => y(+e.Value))
                    .attr("width", x.bandwidth())
                    .attr("height", (e) => height3 - y(+e.Value))
                    .attr("fill", "blue");
            }

var year = 2000
const sliderRange= d3
.sliderBottom()
.min(2000)
.max(2021)
.width(600)
.step(1)
.tickFormat(d3.format('Y'))
.ticks(5)
.default(year)
.on('onchange', val => {
    year = val
      updateBars(year)
    })
        const gRange= d3.
        select('#container3')
        .append("svg")
        .attr("width", 600 + margin3.left + margin3.right)
        .attr("height", 10 + margin3.top + margin3.bottom)
        .append("g")
        .attr("transform","translate(" + margin3.left + "," + margin3.top + ")")
        .call(sliderRange);

        })
        .catch((err) => {
            console.log({ err });
        });
</script>