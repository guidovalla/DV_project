<h5 class="card-title">Chart 1</h5>

<p>
Life expectancy has been on a steady increase ever since the end of WW2 and the following economic boom in the 50's, up until today. What is gonna happen in the future? And what are the longterm effects of this increased LE? In this section we try to see if it's possible to answer these questions using data and projections from the UN
in this linechart is possible to see the variation of some parameters over time. 3 lines are present, each representing the projected number of births, death and the difference between the two (change) every year from 2023 up to 2100, with each line colour following the legend on the top of the chart. By clicking on the coloured boxes in the legend is possible to remove or visualize the 3 lines. A red line is also present, indicating the 0 value.
<br>
<br>
</p>
<!-- Create a container to host the charts -->

<!-- first chart -->
<div id="container"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.6.0/d3.js"></script>
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">

<style>

 
*{
  font-family: Lato;
  font-size: 18px;
  line-height: 1.5;
}
  .axis-x path {
    stroke: #000;
  }

  .line {
    fill: none;
    stroke-width: 1.5px;
    stroke-linejoin: "round";
    stroke-linecap: "round";
  }

  .line:hover {
    stroke-width: 2px;
  }

  #headline{
    min-width:100%;
  }

  #menu{
    display: inline;
    width: 100%;
    /* border:1px solid black; */
    /* padding: 1%; */
  }

  #nation{
    display: inline;
    padding-left: 1%;
  }




</style>




<div id="menu">
</div>
<div class="graph">
 
<svg width="800" height="500"></svg>
<br>


</div>


<script>
var lineColors = ['#cacaca','#423189', '#e88467']; // Add more colors as needed


//define chart margins
let svg = d3.select("svg"),
margin = {
top: 30,
right: 80,
bottom: 40,
left: 50
},

width = svg.attr("width") - margin.left - margin.right,
height = svg.attr("height") - margin.top - margin.bottom,
g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

//define time format
var parseTime = d3.timeParse("%Y");


//define scales
let x = d3.scaleTime().range([0, width]),
y = d3.scaleLinear().range([height, 0]),
//color scale
z = d3.scaleOrdinal(d3.schemeCategory20);

//define line generator
let line = d3.line()
.curve(d3.curveBasis)
.x(function(d) {
return x(d.Year);
})
.y(function(d) {
return y(d.expenditure);
});

//load data
data = d3.csv("https://raw.githubusercontent.com/guidovalla/DV_project/main/data/4_1.csv", type, function(error, data) {
if (error) throw error;



// format the data
// data.forEach( function(d) {
//   console.log(d.Year);
// d.Year = parseTime(d.Year);
// console.log(d.Year)
// });

//parse data
var countries = data.columns.slice(1).map(function(id) {
return {
id: id,
values: data.map(function(d) {
  return {
      Year: d.Year,
      expenditure: d[id]

  };


})
};
});

//console.log(countries);

//

//define x axis
x.domain(d3.extent(data, function(d) {
return d.Year;
}));


//console.log("x domain", x.domain());



//define y axis
y.domain([
d3.min(countries, function(c) {
return d3.min(c.values, function(d) {
  return d.expenditure;
});
}),
d3.max(countries, function(c) {
return d3.max(c.values, function(d) {
  return d.expenditure;
});
})
]);



//append x axis
g.append("g")
.attr("class", "axis axis-x")
.attr("transform", "translate(0," + height + ")")
.call(d3.axisBottom(x))
.append("text")
// .attr("transform", "rotate(-90)")
.attr("y", 20)
.attr("x", 310)
.attr("dy", "0.9em")
.attr("fill", "#000")
// .text("Year")
.append("text")
// .attr("transform", "rotate(-90)")
.attr("y", 20)
.attr("x", 310)
.attr("dy", "0.9em")
.attr("fill", "#000")
.text("Source:Sipri");

//append y axis
g.append("g")
.attr("class", "axis axis-y")
.call(d3.axisLeft(y))
.append("text")
.attr("transform", "rotate(-90)")
.attr("y", -50)
.attr("x", -125)
.attr("dy", "0.9em")
.attr("fill", "#000")
.text("Milions of people");

// Append line at y=0
g.append("line")
    .attr("class", "zero-line")
    .attr("x1", 0)
    .attr("y1", y(0))
    .attr("x2", width)
    .attr("y2", y(0))
    .style("stroke", "red") // Customize the color as needed
    .style("stroke-width", 2);

//append country data to svg
let country = g.selectAll(".country")
.data(countries)
.enter()
.append("g")
.attr("class", "country")
// 	d3.selectAll(".myCheckbox").on("change",update);
// update();

// append country path to svg
country.append("path")
.attr("class", "line")
.attr('id', function(d){ return 'line-' + d.id })
.attr("d", function(d) {return line(d.values); })
.style("stroke", function(d, i) { return lineColors[i % lineColors.length]; }) // Assign color directly
.style("stroke-width", 3) // Set the desired stroke width
.style("stroke-dasharray", function(d, i) {
// Set the dash array for the line you want to be dotted
return i === 0 ? "5,5" : "none";
})
//.style("stroke", function(d) { return z(d.id).color; })
.attr("opacity", 1);


// Create a legend
var legend = g.append("g")
.attr("class", "legend")
.attr("transform", "translate(" + (width + 10) + "," + 0 + ")"); // Adjust the translate values as needed

// Append rectangles and text for each line in the legend
legend.selectAll("rect")
.data(countries)
.enter()
.append("rect")
.attr("x", 0)
.attr("y", function(d, i) { return i * 20; }) // Adjust the spacing between legend items
.attr("width", 18)
.attr("height", 18)
.style("fill", function(d, i) { return lineColors[i % lineColors.length]; }) 

legend.selectAll("text")
.data(countries)
.enter()
.append("text")
.attr("x", 25)
.attr("y", function(d, i) { return i * 20 + 9; }) // Adjust the spacing and alignment
.attr("dy", "0.35em")
.style("font", "11px sans-serif")
.text(function(d) { return d.id; });




var longY = function (d) {return d.value.Year.length};
//console.log(longY);
var longE = function (d) {return d.value.Year.length};
//console.log(longE);
// append country labels to svg
country.append("text")
.datum(function(d) { return {id: d.id, value: d.values[d.values.length - 1]}; })
.attr("transform", function(d) { return "translate(" + x(d.value.Year) + "," + y(d.value.countries) + ")"; })
.attr("x", 3)
.attr('id', function(d){ return 'text-' + d.id })
.attr("dy", "0.35em")
.style("font", "11px sans-serif")
.attr("opacity", 1)
//.text(function(d) { return d.id; });

for (let i = 0; i < countries.length; i++) {
var tick = document.createElement('input');
tick.type = 'checkbox';
tick.id = 'myCheckbox'+i;
tick.name = countries[i].id;
tick.value = countries[i].id;

tick.checked = true;

var label = document.createElement('label');
label.for = countries[i].id
label.appendChild(document.createTextNode(countries[i].id));
var divcheck = document.createElement('div');
divcheck.id="nation";
// tick.appendChild(document.createTextNode(countries[i].id));
divcheck.appendChild(tick);
divcheck.appendChild(label);
document.getElementById("menu").appendChild(divcheck);
///console.log("tick", tick)



tick.addEventListener("click", function() {

var lineSelected = this.value;
var svgline = d3.select('#line-' + lineSelected);
var textline = d3.select('#text-' + lineSelected);
//console.log(svgline);
//console.log(textline);

if(svgline.attr('opacity') === '1') {
  // console.log('making it visible');
  svgline.attr('opacity', 0);
} else {
  svgline.attr('opacity', 1);
}

if(textline.attr('opacity') === '1') {
  // console.log('making it visible');
  textline.attr('opacity', 0);
} else {
  textline.attr('opacity', 1);
}
this.style.background = '#555';
this.style.color = 'white';

});



}



});

//bind with multiseries data
function type(d, _, columns) {
d.Year = parseTime(d.Year);
//iterate through each column
for (var i = 1, n = columns.length, c; i < n; ++i) d[c = columns[i]] = +d[c];

//bind column data to year
return d;
}






</script>